namespace SpriteKind {
    export const DirectionDown = SpriteKind.create()
    export const DirectionLeft = SpriteKind.create()
    export const DirectionRight = SpriteKind.create()
    export const End = SpriteKind.create()
    export const Tower = SpriteKind.create()
}
namespace myTiles {
    //% blockIdentity=images._tile
    export const tile0 = img`
. . . . . . . . . . . . . . . . 
. . . . . . . . . . . . . . . . 
. . . . . . . . . . . . . . . . 
. . . . . . . . . . . . . . . . 
. . . . . . . . . . . . . . . . 
. . . . . . . . . . . . . . . . 
. . . . . . . . . . . . . . . . 
. . . . . . . . . . . . . . . . 
. . . . . . . . . . . . . . . . 
. . . . . . . . . . . . . . . . 
. . . . . . . . . . . . . . . . 
. . . . . . . . . . . . . . . . 
. . . . . . . . . . . . . . . . 
. . . . . . . . . . . . . . . . 
. . . . . . . . . . . . . . . . 
. . . . . . . . . . . . . . . . 
`
    //% blockIdentity=images._tile
    export const tile1 = img`
7 7 7 7 7 7 7 7 7 7 7 7 7 7 7 7 
7 7 7 7 7 7 7 7 7 7 7 7 7 7 7 7 
7 7 7 7 7 7 7 7 7 7 7 7 7 7 7 7 
7 7 7 7 7 7 7 7 7 7 7 7 7 7 7 7 
7 7 7 7 7 7 7 7 7 7 7 7 7 7 7 7 
7 7 7 7 7 7 7 7 7 7 7 7 7 7 7 7 
7 7 7 7 7 7 7 7 7 7 7 7 7 7 7 7 
7 7 7 7 7 7 7 7 7 7 7 7 7 7 7 7 
7 7 7 7 7 7 7 7 7 7 7 7 7 7 7 7 
7 7 7 7 7 7 7 7 7 7 7 7 7 7 7 7 
7 7 7 7 7 7 7 7 7 7 7 7 7 7 7 7 
7 7 7 7 7 7 7 7 7 7 7 7 7 7 7 7 
7 7 7 7 7 7 7 7 7 7 7 7 7 7 7 7 
7 7 7 7 7 7 7 7 7 7 7 7 7 7 7 7 
7 7 7 7 7 7 7 7 7 7 7 7 7 7 7 7 
7 7 7 7 7 7 7 7 7 7 7 7 7 7 7 7 
`
    //% blockIdentity=images._tile
    export const tile2 = img`
9 9 9 9 9 9 9 9 9 9 9 9 9 9 9 9 
9 9 9 9 9 9 9 9 9 9 9 9 9 9 9 9 
9 9 9 9 9 9 9 9 9 9 9 9 9 9 9 9 
9 9 9 9 9 9 9 9 9 9 9 9 9 9 9 9 
9 9 9 9 9 9 9 9 9 9 9 9 9 9 9 9 
9 9 9 9 9 9 9 9 9 9 9 9 9 9 9 9 
9 9 9 9 9 9 9 9 9 9 9 9 9 9 9 9 
9 9 9 9 9 9 9 9 9 9 9 9 9 9 9 9 
9 9 9 9 9 9 9 9 9 9 9 9 9 9 9 9 
9 9 9 9 9 9 9 9 9 9 9 9 9 9 9 9 
9 9 9 9 9 9 9 9 9 9 9 9 9 9 9 9 
9 9 9 9 9 9 9 9 9 9 9 9 9 9 9 9 
9 9 9 9 9 9 9 9 9 9 9 9 9 9 9 9 
9 9 9 9 9 9 9 9 9 9 9 9 9 9 9 9 
9 9 9 9 9 9 9 9 9 9 9 9 9 9 9 9 
9 9 9 9 9 9 9 9 9 9 9 9 9 9 9 9 
`
    //% blockIdentity=images._tile
    export const tile3 = img`
7 9 9 9 9 9 9 9 9 9 9 9 9 9 9 9 
7 7 9 9 9 9 9 9 9 9 9 9 9 9 9 9 
7 7 9 9 9 9 9 9 9 9 9 9 9 9 9 9 
7 7 9 9 9 9 9 9 9 9 9 9 9 9 9 9 
7 9 9 9 9 9 9 9 9 9 9 9 9 9 9 9 
7 9 9 9 9 9 9 9 9 9 9 9 9 9 9 9 
7 7 9 9 9 9 9 9 9 9 9 9 9 9 9 9 
7 7 9 9 9 9 9 9 9 9 9 9 9 9 9 9 
7 7 9 9 9 9 9 9 9 9 9 9 9 9 9 9 
7 7 9 9 9 9 9 9 9 9 9 9 9 9 9 9 
7 7 9 9 9 9 9 9 9 9 9 9 9 9 9 9 
7 9 9 9 9 9 9 9 9 9 9 9 9 9 9 9 
7 9 9 9 9 9 9 9 9 9 9 9 9 9 9 9 
7 7 9 9 9 9 9 9 9 9 9 9 9 9 9 9 
7 7 7 9 9 9 7 7 7 7 9 9 7 7 7 7 
7 7 7 7 7 7 7 7 7 7 7 7 7 7 7 7 
`
    //% blockIdentity=images._tile
    export const tile4 = img`
7 7 7 7 7 7 7 7 7 7 7 7 7 7 7 7 
7 7 7 7 7 7 7 7 9 9 7 7 7 7 7 9 
7 7 9 9 9 9 9 9 9 9 9 9 9 9 9 9 
7 7 9 9 9 9 9 9 9 9 9 9 9 9 9 9 
7 7 9 9 9 9 9 9 9 9 9 9 9 9 9 9 
7 9 9 9 9 9 9 9 9 9 9 9 9 9 9 9 
7 9 9 9 9 9 9 9 9 9 9 9 9 9 9 9 
7 9 9 9 9 9 9 9 9 9 9 9 9 9 9 9 
7 9 9 9 9 9 9 9 9 9 9 9 9 9 9 9 
7 9 9 9 9 9 9 9 9 9 9 9 9 9 9 9 
7 7 9 9 9 9 9 9 9 9 9 9 9 9 9 9 
7 7 9 9 9 9 9 9 9 9 9 9 9 9 9 9 
7 7 9 9 9 9 9 9 9 9 9 9 9 9 9 9 
7 7 9 9 9 9 9 9 9 9 9 9 9 9 9 9 
7 7 9 9 9 9 9 9 9 9 9 9 9 9 9 9 
7 9 9 9 9 9 9 9 9 9 9 9 9 9 9 9 
`
    //% blockIdentity=images._tile
    export const tile5 = img`
7 7 7 7 7 7 7 7 7 7 7 7 7 7 7 7 
7 7 7 7 9 9 9 9 7 7 7 7 9 9 7 7 
9 7 7 9 9 9 9 9 9 9 7 9 9 9 9 9 
9 9 9 9 9 9 9 9 9 9 9 9 9 9 9 9 
9 9 9 9 9 9 9 9 9 9 9 9 9 9 9 9 
9 9 9 9 9 9 9 9 9 9 9 9 9 9 9 9 
9 9 9 9 9 9 9 9 9 9 9 9 9 9 9 9 
9 9 9 9 9 9 9 9 9 9 9 9 9 9 9 9 
9 9 9 9 9 9 9 9 9 9 9 9 9 9 9 9 
9 9 9 9 9 9 9 9 9 9 9 9 9 9 9 9 
9 9 9 9 9 9 9 9 9 9 9 9 9 9 9 9 
9 9 9 9 9 9 9 9 9 9 9 9 9 9 9 9 
9 9 9 9 9 9 9 9 9 9 9 9 9 9 9 9 
9 9 9 9 9 9 9 9 9 9 9 9 9 9 9 9 
9 9 9 9 9 9 9 9 9 9 9 9 9 9 9 9 
9 9 9 9 9 9 9 9 9 9 9 9 9 9 9 9 
`
    //% blockIdentity=images._tile
    export const tile7 = img`
7 7 7 7 7 7 7 7 7 7 7 7 7 7 7 7 
9 9 7 7 7 7 7 7 7 7 7 7 7 9 7 7 
9 9 9 9 9 9 9 9 9 9 9 9 9 9 7 7 
9 9 9 9 9 9 9 9 9 9 9 9 9 9 9 7 
9 9 9 9 9 9 9 9 9 9 9 9 9 9 9 7 
9 9 9 9 9 9 9 9 9 9 9 9 9 9 9 7 
9 9 9 9 9 9 9 9 9 9 9 9 9 9 9 7 
9 9 9 9 9 9 9 9 9 9 9 9 9 9 9 7 
9 9 9 9 9 9 9 9 9 9 9 9 9 9 7 7 
9 9 9 9 9 9 9 9 9 9 9 9 9 9 7 7 
9 9 9 9 9 9 9 9 9 9 9 9 9 9 7 7 
9 9 9 9 9 9 9 9 9 9 9 9 9 9 7 7 
9 9 9 9 9 9 9 9 9 9 9 9 9 9 7 7 
9 9 9 9 9 9 9 9 9 9 9 9 9 9 9 7 
9 9 9 9 9 9 9 9 9 9 9 9 9 9 9 7 
9 9 9 9 9 9 9 9 9 9 9 9 9 9 7 7 
`
    //% blockIdentity=images._tile
    export const tile8 = img`
9 9 9 9 9 9 9 9 9 9 9 9 9 9 7 7 
9 9 9 9 9 9 9 9 9 9 9 9 9 9 9 7 
9 9 9 9 9 9 9 9 9 9 9 9 9 9 9 7 
9 9 9 9 9 9 9 9 9 9 9 9 9 9 9 7 
9 9 9 9 9 9 9 9 9 9 9 9 9 9 7 7 
9 9 9 9 9 9 9 9 9 9 9 9 9 9 7 7 
9 9 9 9 9 9 9 9 9 9 9 9 9 9 9 7 
9 9 9 9 9 9 9 9 9 9 9 9 9 9 9 7 
9 9 9 9 9 9 9 9 9 9 9 9 9 9 9 7 
9 9 9 9 9 9 9 9 9 9 9 9 9 9 9 7 
9 9 9 9 9 9 9 9 9 9 9 9 9 9 9 7 
9 9 9 9 9 9 9 9 9 9 9 9 9 9 9 7 
9 9 9 9 9 9 9 9 9 9 9 9 9 9 9 7 
9 9 9 9 9 9 9 9 9 9 9 9 9 9 7 7 
9 7 7 7 7 7 9 9 9 7 7 7 7 9 7 7 
7 7 7 7 7 7 7 7 7 7 7 7 7 7 7 7 
`
    //% blockIdentity=images._tile
    export const tile9 = img`
9 9 9 9 9 9 9 9 9 9 9 9 9 9 9 9 
9 9 9 9 9 9 9 9 9 9 9 9 9 9 9 9 
9 9 9 9 9 9 9 9 9 9 9 9 9 9 9 9 
9 9 9 9 9 9 9 9 9 9 9 9 9 9 9 9 
9 9 9 9 9 9 9 9 9 9 9 9 9 9 9 9 
9 9 9 9 9 9 9 9 9 9 9 9 9 9 9 9 
9 9 9 9 9 9 9 9 9 9 9 9 9 9 9 9 
9 9 9 9 9 9 9 9 9 9 9 9 9 9 9 9 
9 9 9 9 9 9 9 9 9 9 9 9 9 9 9 9 
9 9 9 9 9 9 9 9 9 9 9 9 9 9 9 9 
9 9 9 9 9 9 9 9 9 9 9 9 9 9 9 9 
9 9 9 9 9 9 9 9 9 9 9 9 9 9 9 9 
9 9 9 9 9 9 9 9 9 9 9 9 9 9 9 9 
7 9 9 9 7 7 7 9 9 9 9 9 9 9 9 9 
7 7 9 7 7 7 7 7 9 9 9 9 7 7 7 7 
7 7 7 7 7 7 7 7 7 7 7 7 7 7 7 7 
`
}
function ScreenSay (Text: string) {
    OnScreenNarrator.right = scene.cameraLeft()
    OnScreenNarrator.vx = 50
    OnScreenNarrator.say(Text)
}
sprites.onOverlap(SpriteKind.Enemy, SpriteKind.Projectile, function (sprite, otherSprite) {
    Dump = Bloons.removeAt(Bloons.indexOf(sprite))
    sprite.destroy()
    otherSprite.destroy()
    info.changeScoreBy(1)
})
controller.A.onEvent(ControllerButtonEvent.Pressed, function () {
    if (Cursor.tileKindAt(TileDirection.Center, myTiles.tile1) || Cursor.tileKindAt(TileDirection.Center, sprites.castle.tileGrass1) || (Cursor.tileKindAt(TileDirection.Center, sprites.castle.tileGrass3) || Cursor.tileKindAt(TileDirection.Center, sprites.castle.tileGrass2))) {
        Overlap = false
        for (let Value of Towers) {
            if (Cursor.overlapsWith(Value)) {
                Overlap = true
                if (info.score() >= 30) {
                    info.changeScoreBy(-30)
                    if (sprites.readDataBoolean(Value, "NextToUpgrade")) {
                        if (sprites.readDataNumber(Value, "max cooldown") >= 2) {
                            sprites.changeDataNumberBy(Value, "max cooldown", -1)
                            sprites.setDataBoolean(Value, "NextToUpgrade", false)
                        } else {
                            sprites.changeDataNumberBy(Value, "visibility", 8)
                            sprites.setDataBoolean(Value, "NextToUpgrade", true)
                        }
                    } else {
                        sprites.changeDataNumberBy(Value, "visibility", 8)
                        sprites.setDataBoolean(Value, "NextToUpgrade", true)
                    }
                    Value.startEffect(effects.smiles, 1000)
                } else {
                    Cursor.say("Not enough money!", 1000)
                }
            }
        }
        if (!(Overlap)) {
            if (info.score() >= 50) {
                info.changeScoreBy(-50)
                LastTower = sprites.create(img`
. . . . f f f f f . . . . . . . 
. . . f e e e e e f . . . . . . 
. . f d d d d e e e f . . . . . 
. c d f d d f d e e f f . . . . 
. c d f d d f d e e d d f . . . 
c d e e d d d d e e b d c . . . 
c d d d d c d d e e b d c . f f 
c c c c c d d d e e f c . f e f 
. f d d d d d e e f f . . f e f 
. . f f f f f e e e e f . f e f 
. . . . f e e e e e e e f f e f 
. . . f e f f e f e e e e f f . 
. . . f e f f e f e e e e f . . 
. . . f d b f d b f f e f . . . 
. . . f d d c d d b b d f . . . 
. . . . f f f f f f f f f . . . 
`, SpriteKind.Tower)
                Towers.push(LastTower)
                LastTower.setPosition(Cursor.x, Cursor.y)
                LastTower.z = 0
                sprites.setDataNumber(LastTower, "max cooldown", 5)
                sprites.setDataNumber(LastTower, "cooldown", sprites.readDataNumber(LastTower, "max cooldown"))
                sprites.setDataNumber(LastTower, "visibility", 48)
                sprites.setDataBoolean(LastTower, "NextToUpgrade", true)
            } else {
                Cursor.say("Not enough money!", 1000)
            }
        }
    } else {
        Cursor.say("Not a valid spot!", 1000)
    }
})
scene.onHitWall(SpriteKind.Projectile, function (sprite) {
    sprite.destroy()
})
sprites.onOverlap(SpriteKind.Enemy, SpriteKind.DirectionDown, function (sprite, otherSprite) {
    sprite.setVelocity(0, 15 * sprites.readDataNumber(sprite, "wave spawned on"))
})
sprites.onOverlap(SpriteKind.Enemy, SpriteKind.DirectionRight, function (sprite, otherSprite) {
    sprite.setVelocity(15 * sprites.readDataNumber(sprite, "wave spawned on"), 0)
})
info.onCountdownEnd(function () {
    if (Waiting) {
        Waiting = false
        timer.after(500, function () {
            info.startCountdown(10 * Wave)
            ScreenSay("Start of wave " + Wave)
        })
        console.logValue("wave", Wave)
        BloonsSpawned = 0
    } else {
        Waiting = true
        ScreenSay("End of wave " + Wave)
        timer.after(500, function () {
            Wave += 1
            info.startCountdown(15)
        })
    }
})
sprites.onOverlap(SpriteKind.Enemy, SpriteKind.End, function (sprite, otherSprite) {
    sprite.destroy()
    if (true) {
        info.changeLifeBy(-2)
    }
    scene.cameraShake(4, 500)
})
sprites.onOverlap(SpriteKind.Player, SpriteKind.Tower, function (sprite, otherSprite) {
    if (controller.B.isPressed()) {
        Towers.removeAt(Towers.indexOf(otherSprite)).destroy()
        info.changeScoreBy(30)
    }
    timer.throttle("display upgrade", 3000, function () {
        if (sprites.readDataBoolean(otherSprite, "NextToUpgrade")) {
            if (sprites.readDataNumber(otherSprite, "max cooldown") >= 2) {
                otherSprite.say("Next upgrade: Cool down --> " + (sprites.readDataNumber(otherSprite, "max cooldown") - 1) * 100 + " ms for $30", 3000)
            } else {
                otherSprite.say("Next upgrade: Visibility --> " + (sprites.readDataNumber(otherSprite, "visibility") + 8) + " pixels for $30", 3000)
            }
        } else {
            otherSprite.say("Next upgrade: Visibility --> " + (sprites.readDataNumber(otherSprite, "visibility") + 8) + " pixels for $30", 3000)
        }
    })
})
sprites.onOverlap(SpriteKind.Enemy, SpriteKind.DirectionLeft, function (sprite, otherSprite) {
    sprite.setVelocity(15 * sprites.readDataNumber(sprite, "wave spawned on") * -1, 0)
})
let LastBloon: Sprite = null
let Dart: Sprite = null
let ClosestBloon: Sprite = null
let Distance = 0
let ClosestDistance = 0
let LastTower: Sprite = null
let Overlap = false
let Dump: Sprite = null
let BloonsSpawned = 0
let Wave = 0
let Waiting = false
let Bloons: Sprite[] = []
let Towers: Sprite[] = []
let OnScreenNarrator: Sprite = null
let Cursor: Sprite = null
Cursor = sprites.create(img`
f f . . . . . . 
f 1 f . . . . . 
f 1 1 f . . . . 
f 1 1 1 f . . . 
f 1 1 1 1 f . . 
f 1 1 1 1 1 f . 
f 1 1 1 1 f f f 
f 1 f f 1 f . . 
f f . f 1 f . . 
f . . . f 1 f . 
. . . . f 1 f . 
. . . . . f 1 f 
. . . . . f 1 f 
. . . . . . f . 
`, SpriteKind.Player)
Cursor.setFlag(SpriteFlag.StayInScreen, true)
Cursor.setFlag(SpriteFlag.ShowPhysics, false)
Cursor.z = 10000
controller.moveSprite(Cursor, 100, 100)
scene.cameraFollowSprite(Cursor)
OnScreenNarrator = sprites.create(img`
. 
`, SpriteKind.Player)
OnScreenNarrator.setFlag(SpriteFlag.RelativeToCamera, true)
Towers = sprites.allOfKind(SpriteKind.Tower)
Bloons = sprites.allOfKind(SpriteKind.Enemy)
let Downs = sprites.allOfKind(SpriteKind.DirectionDown)
let Lefts = sprites.allOfKind(SpriteKind.DirectionLeft)
let Rights = sprites.allOfKind(SpriteKind.DirectionRight)
Rights.push(sprites.create(img`
3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 
3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 
3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 
3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 
3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 
3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 
3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 
3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 
`, SpriteKind.DirectionRight))
Rights[0].setPosition(36, 42)
Downs.push(sprites.create(img`
3 3 3 3 3 3 3 3 
3 3 3 3 3 3 3 3 
3 3 3 3 3 3 3 3 
3 3 3 3 3 3 3 3 
3 3 3 3 3 3 3 3 
3 3 3 3 3 3 3 3 
3 3 3 3 3 3 3 3 
3 3 3 3 3 3 3 3 
3 3 3 3 3 3 3 3 
3 3 3 3 3 3 3 3 
3 3 3 3 3 3 3 3 
3 3 3 3 3 3 3 3 
3 3 3 3 3 3 3 3 
3 3 3 3 3 3 3 3 
3 3 3 3 3 3 3 3 
3 3 3 3 3 3 3 3 
3 3 3 3 3 3 3 3 
3 3 3 3 3 3 3 3 
3 3 3 3 3 3 3 3 
3 3 3 3 3 3 3 3 
3 3 3 3 3 3 3 3 
3 3 3 3 3 3 3 3 
3 3 3 3 3 3 3 3 
3 3 3 3 3 3 3 3 
3 3 3 3 3 3 3 3 
3 3 3 3 3 3 3 3 
3 3 3 3 3 3 3 3 
3 3 3 3 3 3 3 3 
3 3 3 3 3 3 3 3 
3 3 3 3 3 3 3 3 
3 3 3 3 3 3 3 3 
3 3 3 3 3 3 3 3 
`, SpriteKind.DirectionDown))
Downs[0].setPosition(232, 36)
Lefts.push(sprites.create(img`
3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 
3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 
3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 
3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 
3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 
3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 
3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 
3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 
`, SpriteKind.DirectionLeft))
Lefts[0].setPosition(225, 88)
Downs.push(sprites.create(img`
3 3 3 3 3 3 3 3 
3 3 3 3 3 3 3 3 
3 3 3 3 3 3 3 3 
3 3 3 3 3 3 3 3 
3 3 3 3 3 3 3 3 
3 3 3 3 3 3 3 3 
3 3 3 3 3 3 3 3 
3 3 3 3 3 3 3 3 
3 3 3 3 3 3 3 3 
3 3 3 3 3 3 3 3 
3 3 3 3 3 3 3 3 
3 3 3 3 3 3 3 3 
3 3 3 3 3 3 3 3 
3 3 3 3 3 3 3 3 
3 3 3 3 3 3 3 3 
3 3 3 3 3 3 3 3 
3 3 3 3 3 3 3 3 
3 3 3 3 3 3 3 3 
3 3 3 3 3 3 3 3 
3 3 3 3 3 3 3 3 
3 3 3 3 3 3 3 3 
3 3 3 3 3 3 3 3 
3 3 3 3 3 3 3 3 
3 3 3 3 3 3 3 3 
3 3 3 3 3 3 3 3 
3 3 3 3 3 3 3 3 
3 3 3 3 3 3 3 3 
3 3 3 3 3 3 3 3 
3 3 3 3 3 3 3 3 
3 3 3 3 3 3 3 3 
3 3 3 3 3 3 3 3 
3 3 3 3 3 3 3 3 
`, SpriteKind.DirectionDown))
Downs[1].setPosition(24, 88)
Rights.push(sprites.create(img`
3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 
3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 
3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 
3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 
3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 
3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 
3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 
3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 
`, SpriteKind.DirectionRight))
Rights[1].setPosition(36, 188)
Downs.push(sprites.create(img`
3 3 3 3 3 3 3 3 
3 3 3 3 3 3 3 3 
3 3 3 3 3 3 3 3 
3 3 3 3 3 3 3 3 
3 3 3 3 3 3 3 3 
3 3 3 3 3 3 3 3 
3 3 3 3 3 3 3 3 
3 3 3 3 3 3 3 3 
3 3 3 3 3 3 3 3 
3 3 3 3 3 3 3 3 
3 3 3 3 3 3 3 3 
3 3 3 3 3 3 3 3 
3 3 3 3 3 3 3 3 
3 3 3 3 3 3 3 3 
3 3 3 3 3 3 3 3 
3 3 3 3 3 3 3 3 
3 3 3 3 3 3 3 3 
3 3 3 3 3 3 3 3 
3 3 3 3 3 3 3 3 
3 3 3 3 3 3 3 3 
3 3 3 3 3 3 3 3 
3 3 3 3 3 3 3 3 
3 3 3 3 3 3 3 3 
3 3 3 3 3 3 3 3 
3 3 3 3 3 3 3 3 
3 3 3 3 3 3 3 3 
3 3 3 3 3 3 3 3 
3 3 3 3 3 3 3 3 
3 3 3 3 3 3 3 3 
3 3 3 3 3 3 3 3 
3 3 3 3 3 3 3 3 
3 3 3 3 3 3 3 3 
`, SpriteKind.DirectionDown))
Downs[2].setPosition(232, 180)
Lefts.push(sprites.create(img`
3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 
3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 
3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 
3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 
3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 
3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 
3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 
3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 
`, SpriteKind.DirectionLeft))
Lefts[1].setPosition(225, 230)
for (let Value of Downs) {
    Value.setFlag(SpriteFlag.Invisible, true)
}
for (let Value of Lefts) {
    Value.setFlag(SpriteFlag.Invisible, true)
}
for (let Value of Rights) {
    Value.setFlag(SpriteFlag.Invisible, true)
}
let EndOfMap = sprites.create(img`
3 3 3 3 3 3 3 3 
3 3 3 3 3 3 3 3 
3 3 3 3 3 3 3 3 
3 3 3 3 3 3 3 3 
3 3 3 3 3 3 3 3 
3 3 3 3 3 3 3 3 
3 3 3 3 3 3 3 3 
3 3 3 3 3 3 3 3 
3 3 3 3 3 3 3 3 
3 3 3 3 3 3 3 3 
3 3 3 3 3 3 3 3 
3 3 3 3 3 3 3 3 
3 3 3 3 3 3 3 3 
3 3 3 3 3 3 3 3 
3 3 3 3 3 3 3 3 
3 3 3 3 3 3 3 3 
3 3 3 3 3 3 3 3 
3 3 3 3 3 3 3 3 
3 3 3 3 3 3 3 3 
3 3 3 3 3 3 3 3 
3 3 3 3 3 3 3 3 
3 3 3 3 3 3 3 3 
3 3 3 3 3 3 3 3 
3 3 3 3 3 3 3 3 
3 3 3 3 3 3 3 3 
3 3 3 3 3 3 3 3 
3 3 3 3 3 3 3 3 
3 3 3 3 3 3 3 3 
3 3 3 3 3 3 3 3 
3 3 3 3 3 3 3 3 
3 3 3 3 3 3 3 3 
3 3 3 3 3 3 3 3 
`, SpriteKind.End)
EndOfMap.setPosition(4, 227)
EndOfMap.setFlag(SpriteFlag.Invisible, true)
scene.setBackgroundColor(7)
tiles.setTilemap(tiles.createTilemap(
            hex`1000100012050401011401011301011201010101010502030303030303030303030308140106070707070707070707070702040113010101011201140101140101050401010a03030303030303030303030204120105020707070707070707070707090112050414010101130101010112010101010504010d0e0e0e0e0e0e0e0e0e0f13010504010c111111111111111111100114050413010101010101011401010112010502030303030303030303030308010106070707070707070707070702041401120101140101120101010113050413030303030303030303030303030204010707070707070707070707070707090101140101121401010101130101010112`,
            img`
. . . . . . . . . . . . . . . . 
. . . . . . . . . . . . . . . . 
. . . . . . . . . . . . . . . . 
. . . . . . . . . . . . . . . . 
. . . . . . . . . . . . . . . . 
. . . . . . . . . . . . . . . . 
. . . . . . . . . . . . . . . . 
. . . . . . . . . . . . . . . . 
. . . . . . . . . . . . . . . . 
. . . . . . . . . . . . . . . . 
. . . . . . . . . . . . . . . . 
. . . . . . . . . . . . . . . . 
. . . . . . . . . . . . . . . . 
. . . . . . . . . . . . . . . . 
. . . . . . . . . . . . . . . . 
. . . . . . . . . . . . . . . . 
`,
            [myTiles.tile0,myTiles.tile1,sprites.castle.tilePath5,sprites.castle.tilePath2,sprites.castle.tilePath6,sprites.castle.tilePath4,sprites.castle.tilePath7,sprites.castle.tilePath8,sprites.castle.tilePath3,sprites.castle.tilePath9,sprites.castle.tilePath1,myTiles.tile2,myTiles.tile3,myTiles.tile4,myTiles.tile5,myTiles.tile7,myTiles.tile8,myTiles.tile9,sprites.castle.tileGrass1,sprites.castle.tileGrass3,sprites.castle.tileGrass2],
            TileScale.Sixteen
        ))
info.setLife(100)
info.setScore(100)
let MonkeyFlipped = img`
. . . . f f f f f . . . . . . . 
. . . f e e e e e f . . . . . . 
. . f d d d d e e e f . . . . . 
. c d f d d f d e e f f . . . . 
. c d f d d f d e e d d f . . . 
c d e e d d d d e e b d c . . . 
c d d d d c d d e e b d c . f f 
c c c c c d d d e e f c . f e f 
. f d d d d d e e f f . . f e f 
. . f f f f f e e e e f . f e f 
. . . . f e e e e e e e f f e f 
. . . f e f f e f e e e e f f . 
. . . f e f f e f e e e e f . . 
. . . f d b f d b f f e f . . . 
. . . f d d c d d b b d f . . . 
. . . . f f f f f f f f f . . . 
`
MonkeyFlipped.flipX()
Waiting = true
Wave = 1
BloonsSpawned = 0
info.startCountdown(15)
game.onUpdateInterval(100, function () {
    for (let Value of Towers) {
        if (Bloons.length > 0) {
            ClosestDistance = 99999
            for (let Bloon of Bloons) {
                Distance = Math.sqrt((Bloon.x - Value.x) ** 2 + (Bloon.y - Value.y) ** 2)
                if (Distance < ClosestDistance) {
                    ClosestDistance = Distance
                    ClosestBloon = Bloon
                }
            }
            if (ClosestDistance <= sprites.readDataNumber(Value, "visibility")) {
                if (sprites.readDataNumber(Value, "cooldown") <= 0) {
                    Dart = sprites.create(img`
f f 
f f 
`, SpriteKind.Projectile)
                    Dart.setPosition(Value.x, Value.y)
                    Dart.follow(ClosestBloon, 200)
                    sprites.setDataNumber(Value, "cooldown", sprites.readDataNumber(Value, "max cooldown"))
                } else {
                    sprites.changeDataNumberBy(Value, "cooldown", -1)
                }
            }
        }
    }
})
game.onUpdate(function () {
    if (!(Waiting)) {
        timer.throttle("spawn bloon", 1000 - (Wave - 1) * 25, function () {
            for (let Index = 0; Index <= Wave; Index++) {
                timer.after((1000 - (Wave - 1) * 25) / Wave * Index, function () {
                    LastBloon = sprites.create(img`
. . . . . . 2 2 2 . . . . . . . 
. . . . . 2 2 2 2 2 . . . . . . 
. . . . 2 2 2 2 2 2 2 . . . . . 
. . . . 2 2 2 2 2 2 2 . . . . . 
. . . . 2 2 2 2 2 2 2 . . . . . 
. . . . 2 2 2 2 2 2 2 . . . . . 
. . . . 2 2 2 2 2 2 2 . . . . . 
. . . . . 2 2 2 2 2 . . . . . . 
. . . . . . 2 2 2 . . . . . . . 
. . . . . . . f . . . . . . . . 
. . . . . . . f . . . . . . . . 
. . . . . . . . f . . . . . . . 
. . . . . . . . f . . . . . . . 
. . . . . . . f . . . . . . . . 
. . . . . . . f . . . . . . . . 
. . . . . . . f . . . . . . . . 
`, SpriteKind.Enemy)
                    Bloons.push(LastBloon)
                    sprites.setDataNumber(LastBloon, "wave spawned on", Math.min(Wave, 6 + 2 / 3))
                    LastBloon.setPosition(32, 0)
                    LastBloon.setVelocity(0, 15 * sprites.readDataNumber(LastBloon, "wave spawned on"))
                    BloonsSpawned += 1
                })
            }
            console.logValue("bloons spawned", BloonsSpawned)
        })
    }
    OnScreenNarrator.y = scene.screenHeight() / 2 + scene.cameraTop()
})
game.onUpdateInterval(5000, function () {
    info.changeScoreBy(25)
})
